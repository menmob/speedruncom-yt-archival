import json
import requests
import time
import os
import sys
import random



def getprox():
    proxies = ['23.236.255.53:7104',
'170.244.93.50:7611',
'104.144.78.8:9053',
'192.186.185.6:6565',
'144.168.220.144:8190',
'5.181.42.212:6273',
'104.227.223.136:8223',
'198.154.89.2:6093',
'138.128.121.41:9113',
'45.158.185.9:8521',
'170.244.92.73:8633',
'104.144.147.155:8189',
'104.227.133.145:7207',
'23.254.90.102:8142',
'138.128.78.39:7125',
'45.146.89.158:8221',
'45.135.36.131:6210',
'104.227.173.108:8171',
'191.102.158.95:8159',
'170.244.93.8:7569',
'45.146.89.238:8301',
'104.227.94.176:7736',
'138.128.68.250:7318',
'209.127.164.148:8205',
'45.57.168.102:7106',
'198.20.191.247:7303',
'93.190.245.228:9254',
'138.128.40.186:6189',
'104.144.233.113:9148',
'104.227.13.7:8566',
'45.57.255.108:7147',
'45.95.97.174:8674',
'104.227.173.34:8097',
'45.146.89.106:8169',
'23.236.162.224:9271',
'104.144.233.250:9285',
'191.102.158.121:8185',
'185.245.27.244:7017',
'23.229.107.74:7599',
'144.168.241.19:8613',
'138.128.38.91:6158',
'144.168.241.144:8738',
'185.245.27.56:6829',
'45.57.226.154:9584',
'144.168.137.79:8621',
'104.144.147.76:8110',
'45.158.185.100:8612',
'144.168.241.210:8804',
'144.168.210.194:7239',
'198.154.92.119:9189',
'144.168.241.77:8671',
'209.127.170.45:8138',
'23.229.109.48:6074',
'23.250.48.202:9255',
'23.236.249.110:6160',
'45.72.65.174:8757',
'45.158.185.181:8693',
'23.254.90.110:8150',
'168.205.161.187:6249',
'209.127.183.5:8103',
'45.155.71.125:8714',
'170.244.93.191:7752',
'104.144.109.228:6313',
'192.241.118.63:8630',
'45.95.96.73:8632',
'104.144.3.251:6330',
'45.57.255.143:7182',
'198.154.92.248:9318',
'104.227.223.149:8236',
'23.229.109.55:6081',
'138.128.40.183:6186',
'138.128.38.97:6164',
'209.127.138.249:7346',
'209.127.127.249:7347',
'23.254.113.63:6132',
'209.127.127.69:7167',
'209.127.143.14:8113',
'45.158.185.251:8763',
'45.57.253.73:7610',
'185.245.26.120:6637',
'45.95.99.37:7597',
'45.57.253.177:7714',
'23.236.249.191:6241',
'69.58.9.242:7312',
'104.144.147.153:8187',
'144.168.146.5:7548',
'170.244.92.132:8692',
'104.227.145.142:8737',
'107.152.230.235:9323',
'104.227.133.238:7300',
'185.245.27.87:6860',
'23.229.107.201:7726',
'192.186.185.206:6765',
'138.128.107.91:8680',
'198.154.89.200:6291',
'192.186.185.131:6690',
'209.127.183.84:8182',
'209.127.138.48:7145',
'45.158.184.56:9132',
'107.152.146.150:8668']

    proxy = random.choice(proxies)
    proxy = f'http://{proxy}'
    proxies = {
  "http": proxy,
  "https": proxy,
}
    return(proxies)
os.chdir(sys.path[0])

with open('yt-speedrun-games.txt', 'r') as f:
    games = f.read()
    f.close()

games = games.split('\n')


for game in games:
    offset = 0
    print(game)
    url = f"https://www.speedrun.com/api/v1/runs?game={game}&max=200"
    continue_game = True
    while continue_game:
        print(url)
        data = requests.get(url, proxies=getprox()).text
        data = json.loads(data)
        offset += 200
        if len(data['data']) < 1:
            continue_game = False
        url = f"https://www.speedrun.com/api/v1/runs?game={game}&max=200&offset={offset}"

        for run in data['data']:
            try:
                for video in run['videos']['links']:
                    video = video['uri']
                    print(video)
                    with open('yt-speedrun-links-new.txt', 'a') as f:
                        f.write(video + "\n")

            except:
                pass
        
    

















